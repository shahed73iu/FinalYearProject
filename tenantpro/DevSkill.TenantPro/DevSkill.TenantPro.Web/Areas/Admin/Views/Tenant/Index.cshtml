@model DevSkill.TenantPro.Web.Areas.Admin.Models.TenantViewModel

@{
    ViewData["Title"] = "Index";
}

@section styles
{
    <!-- DataTables -->
    <link rel="stylesheet" href="/admin/plugins/datatables-bs4/css/dataTables.bootstrap4.css">
    <style>
        .ui-datepicker-calendar {
            display: none;
        }

        button.ui-datepicker-current {
            display: none;
        }

        button.ui-datepicker-close {
            margin-top: 1.5rem !important;
            font-size: 13px;
            height: 23.5px;
            border-radius: 8px;
            background-color: lightskyblue;
        }

        .ui-datepicker-prev {
            padding-right: 20px;
        }

        .chosen-container {
            width: 100% !important;
        }
    </style>
    <link href="~/admin/plugins/chosen/chosen.min.css" rel="stylesheet" />
}

@section scripts
{
    <script src="~/admin/plugins/chosen/chosen.jquery.min.js"></script>
    <script>
        //monthPicker
        $(function () {

            $('#monthPicker').hover(function () {

                $('#ui-datepicker-div').addClass('row');
                $('#ui-datepicker-div').addClass('ml-0');

            });
        });
        $(function () {

            $('.monthPicker').hover(function () {

                $('#ui-datepicker-div').addClass('row');
                $('#ui-datepicker-div').addClass('ml-0');

            });
        });

    </script>
    <script>
        $(function () {
            $('#ID1Name').chosen();
        });
        $(function () {
            $('#ID1Format').chosen();
        });
    </script>
    <!-- DataTables -->
    <script src="/admin/plugins/datatables/jquery.dataTables.js"></script>
    <script src="/admin/plugins/datatables-bs4/js/dataTables.bootstrap4.js"></script>
    <script src="~/GenerateBill.js"></script>

    <script>
        $(function () {
            $('#tenantTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/Admin/Tenant/GetTenants",
                "columnDefs": [
                    {
                         "orderable": false,
                        "targets": 7,
                     },
                    {
                        "orderable": false,
                        "targets": 8,
                        "render": function (data, type, row) {
                            return `<button type="submit" class="btn btn-secondary btn-sm m-1" onclick="window.location.href='/admin/tenant/details/${data}'" value='${data}'>
                                                        <i class="far fa-eye"></i>

                                                        View Details
                                                    </button>

                                                        <button type="submit" class="btn btn-info btn-sm m-1" onclick="window.location.href='/admin/tenant/edit/${data}'" value='${data}'>
                                                        <i class="fas fa-pencil-alt">
                                                        </i>
                                                        Edit
                                                    </button>

                                                        <button type="submit" class="btn btn-success btn-sm bill m-1" href="#" data-id='${data}' value='${data}'>
                                                               <i class="fas fa-download"></i>
                                                                Generate Bill
                                                              </button>
                                                       <button type="submit" class="btn btn-success btn-sm FinalBill m-1" href="#" data-id='${data}' value='${data}'>
                                                               <i class="fas fa-download"></i>
                                                                Generate Final Bill
                                                              </button>
                                                    <button type="submit" class="btn btn-danger btn-sm show-bs-modal m-1" href="#" data-id='${data}' value='${data}'>
                                                        <i class="fas fa-trash">
                                                        </i>
                                                        Delete
                                                    </button>`;
                        }
                    }
                ]
            });
        });

        $('#tenantTable').on('click', '.show-bs-modal', function (event) {
            var id = $(this).data("id");
            var modal = $("#modal-default");
            modal.find('.modal-body p').text('Are you sure you want to delete this record?');
            $("#deleteId").val(id);
            modal.modal('show');
        });


        $("#deleteButton").click(function () {
            $("#deleteForm").submit();
        });

        $('#tenantTable').on('click', '.FinalBill', function (event) {
            var id = $(this).data("id");

             var obj = {
                        tenantId : id
                };

                $.ajax({
        type: "GET",
        url: '/Admin/Tenant/GetPrintingsByTenant',
        dataType: "json",
        data: obj,
        success: function (data) {
            if (data == "0") {

            } else {

                var arr = JSON.parse(data);


                for (var i = 1; i < arr.length; i++) {

                    $(".chosen_select_L").chosen('destroy');

                    var num = $('.clonedInputTripExp').length,

                        newNum = new Number(num + 1),
                        newRow = new Number(num),
                        newElem = $('#entryTripExp' + num).clone().attr('id', 'entryTripExp' + newNum).fadeIn('slow');

                    var newIda = $('#entryTripExp' + num).find('.Sl').html(),
                        newId = parseInt(newIda) + 1;

                     newElem.find('.BillFormat').parent().attr('for', 'ID' + newId + 'BillFormat');//Printings[0].Format
                    newElem.find('.BillFormat').attr('id', 'ID' + newId + 'BillFormat').val('').attr('name', 'Payments[' + newIda + '].BillFormat').val('');
                    newElem.find('.BillFormatText').attr('id', 'ID' + newId + 'BillFormatText').val('').attr('id', 'ID' + newIda + 'BillFormatText').val('');


                    newElem.find('.FinalBillDate').parent().attr('for', 'ID' + newId + 'FinalBillDate');//Printings[0].Format
                    newElem.find('.FinalBillDate').attr('id', 'ID' + newId + 'FinalBillDate').val('').attr('name', 'Payments[' + newIda + '].FinalBillDate').val('');
                    newElem.find('.FinalBillDateText').attr('id', 'ID' + newId + 'FinalBillDateText').val('').attr('id', 'ID' + newIda + 'FinalBillDateText').val('');


                    newElem.find('.PaymentAmount').parent().attr('for', 'ID' + newId + 'PaymentAmount');//Printings[0].Format
                    newElem.find('.PaymentAmount').attr('id', 'ID' + newId + 'PaymentAmount').val('').attr('name', 'Payments[' + newIda + '].PaymentAmount').val('');
                    newElem.find('.PaymentAmountText').attr('id', 'ID' + newId + 'PaymentAmountText').val('').attr('id', 'ID' + newIda + 'PaymentAmountText').val('');


                    newElem.find('.DocumentsDetails').parent().attr('for', 'ID' + newId + 'DocumentsDetails');//Printings[0].Format
                    newElem.find('.DocumentsDetails').attr('id', 'ID' + newId + 'DocumentsDetails').val('').attr('name', 'Payments[' + newIda + '].DocumentsDetails').val('');
                    newElem.find('.DocumentsDetailsText').attr('id', 'ID' + newId + 'DocumentsDetailsText').val('').attr('id', 'ID' + newIda + 'DocumentsDetailsText').val('');


                    newElem.find('.PaymentMethod').parent().attr('for', 'ID' + newId + 'PaymentMethod');//Printings[0].Format
                    newElem.find('.PaymentMethod').attr('id', 'ID' + newId + 'PaymentMethod').val('').attr('name', 'Payments[' + newIda + '].PaymentMethod').val('');
                    newElem.find('.PaymentMethodText').attr('id', 'ID' + newId + 'PaymentMethodText').val('').attr('id', 'ID' + newIda + 'PaymentMethodText').val('');


                    //newElem.find('.BillFormatText').parent().attr('for', 'ID' + newId + 'BillFormatText');//Printings[0].Format
                    //newElem.find('.FinalBillDateText').parent().attr('for', 'ID' + newId + 'FinalBillDateText');//Printings[0].Format
                    //newElem.find('.PaymentAmountText').parent().attr('for', 'ID' + newId + 'PaymentAmountText');
                    //newElem.find('.DocumentsDetailsText').parent().attr('for', 'ID' + newId + 'DocumentsDetailsText');
                    //newElem.find('.PaymentMethodText').parent().attr('for', 'ID' + newId + 'PaymentMethodText');




                    $('#entryTripExp' + num).after(newElem);
                    $('#entryTripExp' + newNum).focus();

                    $('#btnDelTripExp').attr('disabled', false);

                    newElem.find('.Sl').html(newNum);
                    $(".chosen_select_L").chosen();
                 //   $('.btnDelTripExp').prop('disabled', true);

                }
                for (var i = 0; i < arr.length; i++) {
                    var id = 'ID'.concat((i + 1)).concat('BillFormat');
                    var element = document.getElementById(id);

                    for (var j = 0; j < arr[i].length; j++) {
                        for (var k = 1; k < element.options.length; k++) {

                            if (element.options[k].value == arr[i][j]) {
                                element.children[k].setAttribute("selected", "selected");
                            }
                        }


                    }
                }

                $(".chosen_select_L").chosen('destroy');

                var num = $('.clonedInputTripExp').length,

                    newNum = new Number(num + 1),
                    newRow = new Number(num),
                    newElem = $('#entryTripExp' + num).clone().attr('id', 'entryTripExp' + newNum).fadeIn('slow');

                var newIda = $('#entryTripExp' + num).find('.Sl').html(),
                    newId = parseInt(newIda) + 1;

                newElem.find('.BillFormat').parent().attr('for', 'ID' + newId + 'BillFormat');//Printings[0].Format
                newElem.find('.BillFormat').attr('id', 'ID' + newId + 'BillFormat').val('').attr('name', 'Payments[' + newIda + '].BillFormat').val('');
                newElem.find('.BillFormatText').attr('id', 'ID' + newId + 'BillFormatText').val('').attr('id', 'ID' + newIda + 'BillFormatText').val('');


                newElem.find('.FinalBillDate').parent().attr('for', 'ID' + newId + 'FinalBillDate');//Printings[0].Format
                newElem.find('.FinalBillDate').attr('id', 'ID' + newId + 'FinalBillDate').val('').attr('name', 'Payments[' + newIda + '].FinalBillDate').val('');
                newElem.find('.FinalBillDateText').attr('id', 'ID' + newId + 'FinalBillDateText').val('').attr('id', 'ID' + newIda + 'FinalBillDateText').val('');



                newElem.find('.PaymentAmount').parent().attr('for', 'ID' + newId + 'PaymentAmount');//Printings[0].Format
                newElem.find('.PaymentAmount').attr('id', 'ID' + newId + 'PaymentAmount').val('').attr('name', 'Payments[' + newIda + '].PaymentAmount').val('');
                newElem.find('.PaymentAmountText').attr('id', 'ID' + newId + 'PaymentAmountText').val('').attr('id', 'ID' + newIda + 'PaymentAmountText').val('');


                newElem.find('.DocumentsDetails').parent().attr('for', 'ID' + newId + 'DocumentsDetails');//Printings[0].Format
                newElem.find('.DocumentsDetails').attr('id', 'ID' + newId + 'DocumentsDetails').val('').attr('name', 'Payments[' + newIda + '].DocumentsDetails').val('');
                newElem.find('.DocumentsDetailsText').attr('id', 'ID' + newId + 'DocumentsDetailsText').val('').attr('id', 'ID' + newIda + 'DocumentsDetailsText').val('');


                newElem.find('.PaymentMethod').parent().attr('for', 'ID' + newId + 'PaymentMethod');//Printings[0].Format
                newElem.find('.PaymentMethod').attr('id', 'ID' + newId + 'PaymentMethod').val('').attr('name', 'Payments[' + newIda + '].PaymentMethod').val('');
                newElem.find('.PaymentMethodText').attr('id', 'ID' + newId + 'PaymentMethodText').val('').attr('id', 'ID[' + newIda + '].PaymentMethodText').val('');


                $('#entryTripExp' + num).after(newElem);
                $('#entryTripExp' + newNum).focus();

                $('#btnDelTripExp').attr('disabled', false);

                newElem.find('.Sl').html(newNum);
                $(".chosen_select_L").chosen();


                event.preventDefault();

                var num = $('.clonedInputTripExp').length,

                    newNum = new Number(num);
                $('#entryTripExp' + newNum).remove();


            }
        },

        statusCode: {
            404: function (content) { alert('cannot find resource'); },
            500: function (content) { alert('internal server error'); }
        },
        error: function (req, status, errorObj) {

        }
    });

            var modal = $("#modal-default3");
          //  modal.find('.modal-body p').text('Please select the bill type you want to generate.');
            $("#FinalBillId").val(id);
            modal.modal('show');
        });


        //$("#finalBillButton").click(function () {

        //    //var x = document.querySelectorAll('.PaymentAmount');
        //    //for (var i = 0; i < x.length; i++) {
        //    //    if (x[i].value == "") {
        //    //        alert("hi");
        //    //    }
        //    //}

        //   $("#finalBillForm").submit();

        //});

        function validation() {

            var x = document.querySelectorAll('.PaymentAmount');
            for (var i = 0; i < x.length; i++) {
                if (x[i].value == "") {
                    e.preventDefault();
                }
            }
        }

    document.body.addEventListener("change", function (e) {  //bind event to the document
            var targ = e.target;  //get what was clicked on
            var id = targ.id;  //grab the id
            var tenantId = document.getElementById("FinalBillId").value;
            var formatId = id.toString().replace("FinalBillDate", "BillFormat");
            var spanId = id.toString().replace("FinalBillDate", "FinalBillDateText")
           // if (spanId[2] != 1) {
                // spanId[2] = spanId[2] - 1;
                spanId = spanId.replace(spanId[2], spanId[2] - 1);
         //   }
            var format = document.getElementById(formatId);
            var date = document.getElementById(id).value;
            for (var i = 0; i < format.options.length; i++) {
                if (format.options[i].selected == true) {
                    if (format.options[i].value=="ElectricityBill")
                    {
                         var obj = {

                        tenantId: tenantId,
                        time: date,
                    };
                    $.ajax({
                        url: 'GetReading',
                        dataType: "json",
                        data: obj,
                        success: function (data) {
                            if (data == "0") {

                                $("#".concat(spanId)).show();
                                $("#".concat(spanId)).text("in this month no electricity bill is inserted.please update electricity bill at first to generate final bill!").show().fadeIn(1000);
                                document.getElementById(spanId).className += " fail";
                                $("#finalBillButton").prop("disabled", true);
                            } else {
                                $("#".concat(spanId)).hide();
                                 document.getElementById(spanId).classList.remove("fail");
                                 if (document.getElementsByClassName('fail').length != 0) {
                                    $("#finalBillButton").prop("disabled", true);
                                }
                                else $("#finalBillButton").prop("disabled", false);

                            }
                        },

                        statusCode: {
                            404: function (content) { alert('cannot find resource'); },
                            500: function (content) { alert('please select a month in this row first'); }
                        },
                        error: function (req, status, errorObj) {

                        }
                    });
                  }
                }
            }
            var date = targ.value;
           // alert(date+"          "+format);

        });

        document.body.addEventListener("keyup", function (e) {  //bind event to the document
            var targ = e.target;  //get what was clicked on
            var id = targ.id;  //grab the id
            var tenantId = document.getElementById("FinalBillId").value;
            var amount = document.getElementById(id).value;
            var dateId=id.toString().replace("PaymentAmount", "FinalBillDate");
            var formatId = id.toString().replace("PaymentAmount", "BillFormat");
            var spanId = id.toString().replace("PaymentAmount", "PaymentAmountText")
            var date = document.getElementById(dateId).value;
            //alert(date);
           // alert(date)
           /// if (spanId[2] != 1) {
                spanId[2] = spanId[2] - 1;
                spanId = spanId.replace(spanId[2], spanId[2] - 1);
          //  }
            var format = document.getElementById(formatId);
             //var date = document.getElementById(dateId).value;
            //var date = $("#".concat(id)).val();
            var formatarr=[];
            for (var i = 0; i < format.options.length; i++) {
                if (format.options[i].selected == true) {

                    formatarr.push(format.options[i].value);

                }
            }
            var y = JSON.stringify(formatarr);
            y = JSON.parse(y);

             var obj = {

                 tenantId: tenantId,
                 time: date.toString(),
                 format: y.toString(),
                 amount: amount
                };
                $.ajax({
                    url: 'ValidateAmount',
                    dataType: "json",
                    data: obj,
                    success: function (data) {
                        if (data == "0") {
                          //  alert(document.getElementsByClassName('fail').length);

                            $("#".concat(spanId)).show();

                            $("#".concat(spanId)).text("Your total amount is grater than due amount or total bill").show().fadeIn(1000);

                            document.getElementById(spanId).className += " fail";

                            $("#finalBillButton").prop("disabled", true);
                        }
                        else if (data == "2")
                        {

                           // $("#notifySpan").show();
                           // $("#notifySpan").text("The bill of this month id paid.Please remove row no " + dateId[2]).show().fadeIn(1000);

                                var num = $('.clonedInputTripExp').length,

                                    newNum = new Number(num);

                                    var tr = $('#entryTripExp' + dateId[2]).closest('tr');
                                        var table = tr.closest('table');
                                        tr.remove();
                                        updateIndexesExp(table);
                              // alert($('#tblExpenseCounty tr').length);
                           if ($('#tblExpenseCount tr').length == 1) $("#finalBillButton").prop("disabled", true);
                        }
                        else {

                            {
                                $("#notifySpan").hide();
                                $("#".concat(spanId)).hide();
                                document.getElementById(spanId).classList.remove("fail");
                                if (document.getElementsByClassName('fail').length != 0) {
                                    $("#finalBillButton").prop("disabled", true);
                                }
                                else $("#finalBillButton").prop("disabled", false);
                            }
                        }
                    },

                    statusCode: {
                        404: function (content) { alert('cannot find resource'); },
                        500: function (content) { alert('please select a month in this row first'); }
                    },
                    error: function (req, status, errorObj) {

                    }
                });
            var date = targ.value;
          //  alert(singlestring);

        });





        $('#btnAddTripExp').on('click', function () {

            $(".chosen_select_L").chosen('destroy');

            var num = $('.clonedInputTripExp').length,

                newNum = new Number(num + 1),
                newRow = new Number(num),
                newElem = $('#entryTripExp' + num).clone().attr('id', 'entryTripExp' + newNum).fadeIn('slow');

            var newIda = $('#entryTripExp' + num).find('.Sl').html(),
                newId = parseInt(newIda) + 1;

            newElem.find('.BillFormat').parent().attr('for', 'ID' + newId + 'BillFormat');//Printings[0].Format
        //    newElem.find('.BillFormatText').parent().attr('for', 'ID' + newId + 'BillFormatText');//Printings[0].Format
            newElem.find('.BillFormat').attr('id', 'ID' + newId + 'BillFormat').val('').attr('name', 'Payments[' + newIda + '].BillFormat').val('');
            newElem.find('.BillFormatText').attr('id', 'ID' + newId + 'BillFormatText').val('').attr('id', 'ID' + newIda + 'BillFormatText').val('');



            newElem.find('.FinalBillDate').parent().attr('for', 'ID' + newId + 'FinalBillDate');//Printings[0].Format
        //    newElem.find('.FinalBillDateText').parent().attr('for', 'ID' + newId + 'FinalBillDateText');//Printings[0].Format
            newElem.find('.FinalBillDate').attr('id', 'ID' + newId + 'FinalBillDate').val('').attr('name', 'Payments[' + newIda + '].FinalBillDate').val('');
             newElem.find('.FinalBillDateText').attr('id', 'ID' + newId + 'FinalBillDateText').val('').attr('id', 'ID' + newIda + 'FinalBillDateText').val('');


            newElem.find('.PaymentAmount').parent().attr('for', 'ID' + newId + 'PaymentAmount');//Printings[0].Format
        //    newElem.find('.PaymentAmountText').parent().attr('for', 'ID' + newId + 'PaymentAmountText');
            newElem.find('.PaymentAmount').attr('id', 'ID' + newId + 'PaymentAmount').val('').attr('name', 'Payments[' + newIda + '].PaymentAmount').val('');
            newElem.find('.PaymentAmountText').attr('id', 'ID' + newId + 'PaymentAmountText').val('').attr('id', 'ID' + newIda + 'PaymentAmountText').val('');



            newElem.find('.DocumentsDetails').parent().attr('for', 'ID' + newId + 'DocumentsDetails');//Printings[0].Format
        //    newElem.find('.DocumentsDetailsText').parent().attr('for', 'ID' + newId + 'DocumentsDetailsText');
            newElem.find('.DocumentsDetails').attr('id', 'ID' + newId + 'DocumentsDetails').val('').attr('name', 'Payments[' + newIda + '].DocumentsDetails').val('');
            newElem.find('.DocumentsDetailsText').attr('id', 'ID' + newId + 'DocumentsDetailsText').val('').attr('id', 'ID' + newIda + 'DocumentsDetailsText').val('');


            newElem.find('.PaymentMethod').parent().attr('for', 'ID' + newId + 'PaymentMethod');//Printings[0].Format
         //   newElem.find('.PaymentMethodText').parent().attr('for', 'ID' + newId + 'PaymentMethodText');
            newElem.find('.PaymentMethod').attr('id', 'ID' + newId + 'PaymentMethod').val('').attr('name', 'Payments[' + newIda + '].PaymentMethod').val('');
            newElem.find('.PaymentMethodText').attr('id', 'ID' + newId + 'PaymentMethodText').val('').attr('id', 'ID[' + newIda + '].PaymentMethodText').val('');



            $('#entryTripExp' + num).after(newElem);
            $('#entryTripExp' + newNum).focus();

            $('#btnDelTripExp').attr('disabled', false);

            newElem.find('.Sl').html(newNum);
            $(".chosen_select_L").chosen();
        });




        $(document).on('click', '.btnDelTripExp', function () {
           // location.reload( true );
            event.preventDefault();

            var num = $('.clonedInputTripExp').length,

                newNum = new Number(num);

            if (newNum == 1) {
                $('.btnDelTripExp').attr('disabled', true);
                alert("Minimum fill one row!!");
            }
            else {
                var tr = $(this).closest('tr');
                tr.addClass("bg-danger");
                tr.fadeOut(500, function () {
                    var table = tr.closest('table');
                    tr.remove();
                    updateIndexesExp(table);
                });
            }

        });
        // Update Clond Input fields Indexes

        function updateIndexesExp(table) {

            table.find("tr:gt(0)").each(function (i, row) {
                $(row).find("td:first").html(i + 1);
                var id = i + 1;

                $(row).find('.BillFormat').attr('name', 'Payments[' + id + '].BillFormat');
                $(row).find('.PaymentAmount').attr('name', 'Payments[' + id + '].PaymentAmount');
                $(row).find('.DocumentsDetails').attr('name', 'Payments[' + id + '].DocumentsDetails');
                $(row).find('.FinalBillDate').attr('name', 'Payments[' + id + '].FinalBillDate');
                $(row).find('.PaymentMethod').attr('name', 'Payments[' + id + '].PaymentMethod');

                $(row).find('.BillFormatText').attr('id', 'ID' + id + 'BillFormatText');
                $(row).find('.PaymentAmountText').attr('id', 'ID' + id + 'PaymentAmountText');
                $(row).find('.DocumentsDetailsText').attr('id', 'ID' + id + 'DocumentsDetailsText');
                $(row).find('.FinalBillDateText').attr('id', 'ID' + id + 'FinalBillDateText');
                $(row).find('.PaymentMethodText').attr('id', 'ID' + id + 'PaymentMethodText');


                $(row).attr('id', 'entryTripExp' + id);

                $(row).find('input,textarea,select').each(function (j, input) {

                    var id = input.name.match(/\d+/);
                    if (id != null && id.length && id.length == 1) {
                        var attr = $(input).attr("name");
                        var newName = attr.replace(attr.match(/\d+/), i);
                        $(input).attr("name", newName);
                    }

                    var id = input.id.match(/\d+/);
                    if (id != null && id.length && id.length == 1) {
                        var attr = $(input).attr("id");
                        var newName = attr.replace(attr.match(/\d+/),(i+1));
                        $(input).attr("id", (newName));
                    }

                  //  var id =

                });

                $(row).find('p').each(function (j, input) {

                    var id = input.id.match(/\d+/);
                    if (id != null && id.length && id.length == 1) {
                        var attr = $(input).attr("id");
                        var newName = attr.replace(attr.match(/\d+/),(i));
                        $(input).attr("id", (newName));
                    }

                });

                 $(row).find('td').each(function (j, input) {

                     var id = input.id.match(/\d+/);
                    if (id != null && id.length && id.length == 1) {
                        var attr = $(input).attr("for");
                        var newName = attr.replace(attr.match(/\d+/),(i+1));
                        $(input).attr("for", (newName));
                    }

                });

                var docs = document.querySelectorAll('.DocumentsDetails')
                for (var x = 0; x < docs.length; x++) {
                    docs[x].name='Payments['+x+'].'+'DocumentsDetails'
                }

            });
        }




         @*Start Add , Remove Row Dynamically  *@


        @*START Jquery Add row for product Feature*@

        // Update Clond Input fields Indexes
        @* END Jquery Add row for product Feature*@


    @*End  Add , Remove Row Dynamically *@







        $("#billButton").click(function () {

            $("#billForm").submit();
        });
        $("#cancelButton").click(function () {
            location.reload();
        });
        $(".close").click(function () {
            location.reload();
        });
        $("#finalBillCancel").click(function () {
            location.reload();
        });
        $(function () {
            $('.date-picker').datepicker({
                changeMonth: true,
                changeYear: true,
                showButtonPanel: true,
                dateFormat: 'MM yy',
                onClose: function (dateText, inst) {

                    function isDonePressed() {

                        return ($('#ui-datepicker-div').html().indexOf('ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all ui-state-hover') > -1);
                    }

                    if (isDonePressed()) {
                        $('#billButton').prop('disabled', false);


                        var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                        var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                        $(this).datepicker('setDate', new Date(year, month, 1));
                        var tenantId = $('#billId').val();
                        var time = $('#monthPicker').val();
                        var obj = {

                            tenantId: tenantId,
                            startDate: time,
                        };
                        $.ajax({
                            url: 'GetReadingofTenant',
                            dataType: "json",
                            data: obj,
                            success: function (data) {
                                if (data[0] == "0") {
                                    var flag = 0;
                                    for (var i = 1; i <= data[1]; i++) {
                                        var elements = document.getElementById("ID" + i + "Name");
                                        for (j = 1; j < elements.options.length; j++) {
                                            if (elements.options[j].value == "ElectricityBill" && elements.options[j].selected == true) {
                                                elements[j].selected = false;
                                                flag = flag + 1;

                                            }
                                        }

                                    }

                                    $(".chosen_select_L").chosen('destroy');

                                           var num = $('.clonedInputTripExp').length,

                                            newNum = new Number(num + 1),
                                            newRow = new Number(num),
                                            newElem = $('#entryTripExp' + num).clone().attr('id', 'entryTripExp' + newNum).fadeIn('slow');

                                        var newIda = $('#entryTripExp' + num).find('.Sl').html(),
                                            newId = parseInt(newIda) + 1;
                                        newElem.find('.Name').parent().attr('for', 'ID' + newId + 'Name');//Printings[0].Format
                                        newElem.find('.Name').attr('id', 'ID' + newId + 'Name').val('').attr('name', 'Printings[' + newIda + '].BillFormat').val('');

                                        $('#entryTripExp' + num).after(newElem);
                                        $('#entryTripExp' + newNum).focus();

                                        $('#btnDelTripExp').attr('disabled', false);

                                           newElem.find('.Sl').html(newNum);
                                           $(".chosen_select_L").chosen();
                                    var num = $('.clonedInputTripExp').length,

                                     newNum = new Number(num);
                                    $('#entryTripExp' + newNum).remove();

                                    if (flag > 0) {
                                        $("#electricityBillSpan").show();
                                        document.getElementById("electricityBillSpan").textContent = "No Electricity bill found for selected month";

                                    }
                                    if (flag == 0) {
                                        $("#electricityBillSpan").hide();
                                    }

                                }
                                else {

                                    $("#electricityBillSpan").hide();

                                }
                            },

                            statusCode: {
                                404: function (content) { alert('cannot find resource'); },
                                500: function (content) { alert('internal server error'); }
                            },
                            error: function (req, status, errorObj) {

                            }
                        });
                        console.log('Done is pressed')

                    }
                }
            });
        });


         function myFunction() {


                if ($("#DocumentsDetails").val() == "") {
                    $("#DocumentsDetailsText").text("please give document details!").show().fadeIn(1000);
                    event.preventDefault();
                }
                if ($("#PaymentAmount").val() == "") {
                    $("#PaymentAmountText").text("please give payment amount!").show().fadeIn(1000);
                    event.preventDefault();
                }

        }



    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".monthPicker").datepicker({
                dateFormat: 'MM yy',
                changeMonth: true,
                changeYear: true,
                showButtonPanel: true,

                onClose: function (dateText, inst) {
                    var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                    var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                    $(this).val($.datepicker.formatDate('MM yy', new Date(year, month, 1)));
                }
            });

            $(".monthPicker").focus(function () {
                $(".ui-datepicker-calendar").hide();
                $("#ui-datepicker-div").position({
                    my: "center top",
                    at: "center bottom",
                    of: $(this)
                });
            });
        });
    </script>
    



}

@section notification
{
    @await Html.PartialAsync("_Notification", Model.Notification)
}

<div class="row">
    <div class="col-12">

        <div class="card">
            <div class="row p-5">
                <div class="col-md-12">
                    <form role="form" id="GenerateBill" action="~/admin/Tenant/BulkPrinting" method="post">
                        @Html.AntiForgeryToken()
                        <div class="col-md-6" style="float:left">
                            <label class="">Date</label>
                            <input name="ReadingTakenDate" value="@DateTime.Now" class="monthPicker" style="width:400px;" required />
                        </div>
                        <div class="col-md-6" style="float:left">

                            <input type="submit" class="btn-success form-control form-control-sm" id="bulkPrintButton" style="width:400px;" form="GenerateBill" value="DraftBill  Bulk  Printing" />

                        </div>
                    </form>
                </div>
            </div>
            <div class="card-header">
                <h3 class="card-title">Tenant details View table</h3>
            </div>
            @*<form role="form" id="GenerateBill" action="~/admin/Tenant/BulkPrinting" method="post">
                    @Html.AntiForgeryToken()
                    <input id="BulkPrint" name="ReadingTakenDate"  hidden />

                </form>*@
            <!-- /.card-header -->
            <div class="card-body">
                <table id="tenantTable" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Payment Type</th>
                            <th>Advance Payment</th>
                            <th>Rent</th>
                            <th>Gas Bill</th>
                            <th>Water Bill</th>

                            <th>Service Charge</th>
                            <th>Contact Person</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <!-- /.card -->
    </div>
    <!-- /.col -->
</div>
<!-- /.row -->

<div class="modal fade" id="modal-default">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>One fine body&hellip;</p>

                <form id="deleteForm" action="/Admin/Tenant/Delete" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="deleteId" value="" name="id" />
                </form>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="deleteButton" class="btn btn-danger">Yes, Delete!</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="modal fade" id="modal-default2">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Generate Bill</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>One fine body&hellip;</p>
                <span id="electricityBillSpan" class="text-danger"></span>
                <form id="billForm" action="/Admin/Tenant/GenerateBill" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="billId" name="id" />

                    <table class="table table-bordered table-striped table-condensed mb-none" id="tblExpenseCounty">
                        <thead>
                            <tr>
                                <th>#SL</th>
                                <th>Bill Type</th>

                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int x = 1;
                            }
                            <tr class="clonedInputTripExpt" id="entryTripExpt@{@x}">
                                <td class="Sl">1</td>
                                <td>
                                    <select id="ID1Name" name="Printings[0].BillFormat" class="Name form-control form-control-sm chosen_select_L" multiple style="width: 100%;">
                                        <option disabled> Please Select a Bill Type</option>
                                        @foreach (var item in ViewBag.BillType)
                                        {
                                            <option value="@item">@item</option>
                                        }
                                    </select>

                                </td>



                                <td class="text-center">
                                    <a href="javascript:void(0)" class="btnDelTripExpt" style="cursor: pointer;">
                                        X
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="row">
                        <div class="col-md-4">

                        </div>
                        <div class="col-md-4">

                        </div>
                        <div class="col-md-4" style="text-align:right">
                            <button class="btn btn-primary input-sm" type="button" name="btnAddTripExpt" id="btnAddTripExpt">
                                <i class="fa fa-plus"></i> Add More Rows
                            </button>

                        </div>
                    </div>

                    <div class="form-group m-3">

                        <label for="monthPicker">Month :</label>
                        <input name="MonthPicker" id="monthPicker" autocomplete="off" class="date-picker" readonly />

                    </div>


                </form>
            </div>

            <div class="modal-footer justify-content-between">
                <button type="button" id="cancelButton" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button id="billButton" class="btn btn-warning"><i class="fas fa-print pr-2"></i>Print</button>
            </div>
        </div>
        /.modal-content
    </div>
    /.modal-dialog
</div>




<div class="modal fade" id="modal-default3">

    <div class="modal-dialog modal-xl">

        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Generate Final Bill</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>One fine body&hellip;</p>
                <span id="notifySpan" class="text-danger"></span>
                <form id="finalBillForm" action="/Admin/Tenant/GenerateFinalBill" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="FinalBillId" name="Payments[0].TenantId" />
                    <table class="table table-bordered table-striped table-condensed mb-none" id="tblExpenseCount">
                        <thead>
                            <tr>
                                <th>#SL</th>
                                <th>Bill Format</th>
                                <th>date</th>
                                <th>Payment Type</th>
                                <th>Payment Amount</th>
                                <th>Documents</th>
                                <th>Action</th>

                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int y = 1;
                            }
                            <tr class="clonedInputTripExp" id="entryTripExp@{@y}">
                                <td class="Sl">1</td>
                                <td>
                                    <p class="BillFormatText text-danger" id="ID0BillFormatText"></p>
                                    <select id="ID1BillFormat" name="Payments[0].BillFormat" class="BillFormat form-control form-control-sm chosen_select_L" multiple style="width: 100%;" required>
                                        <option disabled> Please Select a Bill Type</option>
                                        @foreach (var item in ViewBag.BillType)
                                        {
                                            <option value="@item">@item</option>
                                        }
                                    </select>
                                </td>
                                <td>
                                    <p class="FinalBillDateText text-danger" id="ID0FinalBillDateText"></p>
                                    <input type="date" name="Payments[0].FinalBillDate" class="FinalBillDate form-control form-control-sm" id="ID1FinalBillDate" required />
                                </td>
                                <td>
                                    <p class="PaymentMethodText text-danger" id="ID0PaymentMethodText"></p>
                                    <select id="ID1PaymentMethod" name="Payments[0].PaymentMethod" autocomplete="off" class="PaymentMethod form-control form-control-sm" style="width: 100%;" required>
                                        <option> Please Select a Bill Type</option>
                                        @foreach (var item in ViewBag.PaymentMethod)
                                        {
                                            <option value="@item">@item</option>
                                        }
                                    </select>
                                </td>
                                <td>
                                    <p class="PaymentAmountText text-danger" id="ID0PaymentAmountText"></p>
                                    <input type="text" id="ID1PaymentAmount" name="Payments[0].PaymentAmount" class="PaymentAmount form-control form-control-sm" required="required" />
                                </td>
                                <td>

                                    <p class="DocumentsDetailsText text-danger" id="ID0DocumentsDetailsText"></p>

                                    @*<input type="text" id="ID1DocumentsDetails" name="Payments[0].DocumentsDetails" class="DocumentsDetails form-control form-control-sm" />*@

                                    <textarea rows="3" id="ID1DocumentsDetails" name="Payments[0].DocumentsDetails" class="DocumentsDetails form-control form-control-sm" required></textarea>
                                </td>
                                <td class="text-center">
                                    <a href="javascript:void(0)" class="btnDelTripExp" style="cursor: pointer;">
                                        X
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="row">
                        <div class="col-md-4">

                        </div>
                        <div class="col-md-4">

                        </div>
                        <div class="col-md-4" style="text-align:right">
                            <button class="btn btn-primary input-sm" type="button" name="btnAddTripExp" id="btnAddTripExp">
                                <i class="fa fa-plus"></i> Add More Rows
                            </button>

                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" id="finalBillCancel" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" onclick="validation()" id="finalBillButton" class="btn btn-danger">Print</button>
                    </div>

                </form>

            </div>
            @*<div class="modal-footer justify-content-between">
                    <button type="button" id="finalBillCancel" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="finalBillButton" class="btn btn-danger">Print</button>
                </div>*@

        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
